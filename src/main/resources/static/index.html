<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <main>
        <div class="container">
            <div class="img__container">
                <img src="" alt="">
            </div>
            <div class="form__container">
                <form class="form" action="" method="get">
                    <h1>LOGIN</h1>
                    <label for="usuario">Correo Electrónico:</label>
                    <input type="email" id="usuario" required>
                    <label for="contrasena">Contraseña:</label>
                    <input type="password" id="contrasena" required>
                    <a class="registrarse" href="#">Registrarse</a>
                    <input class="form__button" type="submit" value="Iniciar Sesión">
                </form>
            </div>
        </div>
    </main>
    <script>
        document.querySelector('.form').addEventListener('submit', function(e) {
            e.preventDefault();
            const correo = document.getElementById('usuario').value.trim();
            sessionStorage.clear(); // Limpia sesión anterior

            if (correo.endsWith("@empresa.admin.pe")) {
                // --- Lógica de SUPERVISOR ---
                fetch(`http://localhost:8085/api/supervisores/correo/${correo}`)
                    .then(res => {
                        if (!res.ok) throw new Error('Supervisor no encontrado');
                        return res.json();
                    })
                    .then(supervisor => {
                        // Guardamos el supervisor como un objeto de texto
                        supervisor.esSupervisor = true; // Añadimos una bandera
                        sessionStorage.setItem("usuarioLogueado", JSON.stringify(supervisor));

                        window.location.href = "portal-admin.html"; // O a donde quieras que vaya el admin
                    })
                    .catch(err => {
                        console.error(err);
                        alert("Error: Supervisor no encontrado o el servidor falló.");
                    });

            } else if (correo.endsWith("@empresa.com")) {
                // --- Lógica de EMPLEADO ---
                fetch(`http://localhost:8085/api/empleados/correo/${correo}`)
                    .then(res => {
                        if (!res.ok) throw new Error('Empleado no encontrado');
                        return res.json();
                    })
                    .then(empleado => {
                        // Guardamos el empleado como un objeto de texto
                        empleado.esSupervisor = false; // Añadimos una bandera
                        sessionStorage.setItem("usuarioLogueado", JSON.stringify(empleado));

                        window.location.href = "dashboard.html"; // O a donde quieras que vaya el empleado
                    })
                    .catch(err => {
                        console.error(err);
                        alert("Error: Empleado no encontrado o el servidor falló.");
                    });
            } else {
                alert("Correo no reconocido. Use @empresa.com o @empresa.admin.pe");
            }
        });
    </script>
</body>
</html>